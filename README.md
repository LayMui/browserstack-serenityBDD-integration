# kcp-test-automation
# Getting started instructions
### The project directory structure
The project has two test modules
```Gherkin
  Serenity REST API
  Serenity Web UI
```
### Dependencies   
```
Java 11    
Maven 3.6.X or above 
```
### Add Serenity dependencies to the pom.xml
```
https://mvnrepository.com/artifact/net.serenity-bdd/serenity-core
https://mvnrepository.com/artifact/net.serenity-bdd/serenity-junit
https://mvnrepository.com/artifact/net.serenity-bdd/serenity-screenplay
https://mvnrepository.com/artifact/net.serenity-bdd/serenity-rest-assured
```
Environment variables to set at ~/.bash_profile used in the serenity.sh script    
These environment variables are used in Cucumber Studio's tool hiptest-publisher.  
Set the following secret variables at pipeline settings UI  (this is done once by the project administrator)  

API_UID  
API_ACCESS_TOKEN  
API_CLIENT   
PROJECT_TOKEN  
PROJECT_ID  
TEST_RUN_ID_WEB  
TEST_RUN_ID_REST  

The first 3 environment variables API_* are generated in the Cucumber Studio's profile page  
The last 4 environment variables are pertaining to the project KCP and  
test run and is to be shared among the members of the project.   

To downloads/compiles all the needed components in a directory called .m2 under the user's folder.  
The test phase of this mvn can be ignored by using a flag -DskipTests=true
```json
 mvn clean install -DskipTests=true
```
### serenity.sh script
The serenity.sh script is created to simplify the test execution:      
Pre-requisite: Assume you have docker engine installed in your local machine   
Run ./serenity.sh with arguments 
```    
./serenity.sh [rest|web] [sync|update_features|run_tests|push_results] [qa|dev|staging|prod] [local|remote|cloud] [firefox|chrome]
```
The first argument is the framework: rest or web    
The second argument is the task options: sync, update_features, run_tests or push_results   
sync: To synchronise Scenarios to Test Runs in Cucumber Studio     
update_features: To update the feature file from Cucumber Studio      
run_tests: To run the tests    
push_results: To push the test results back to Cucumber Studio     
The third argument is the env for the test to run in,    
Options include qa, dev, staging, prod.    
The fourth argument is required if the framework is web  
local: To run the web UI test locally  
remote: To run the web UI test via Selenium Grid with Docker (this is in the CI pipeline) 
cloud: To run on browserstack (KWA-798)
The fourth argument is optional if the framework is web  
firefox: To run the web UI test in firefox browser  
chrome: To run the web UI test in chrome browser  
(this is the default if this option is not specified)  
To run webUI locally, you need to install the browser driver  
Why need the browser driver installed?   
The "Browser Drivers" are servers that implement the WebDriver's wire protocol    
and know how to convert those commands into the specific browser's proprietary native API  

The test framework is integrated into the CI pipeline in Azure DevOps using the azure-pipelines.yml    

To run on browserstack accessed from the browserstack dashboard 
at https://automate.browserstack.com/dashboard/v2/
export BROWSERSTACK_USERNAME=<browserstack-username> &&
export BROWSERSTACK_ACCESS_KEY=<browserstack-access-key>

The test results will be recorded in the `target/site/serenity` directory.    
$ open index.html in a browser to see the nice reporting generated by Serenity

Produce the emailable summary report when we run the aggregate goal
```
mvn serenity:reports -Dserenity.reports=single-page-html
```
